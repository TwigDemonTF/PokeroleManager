<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pokémon Stats Viewer - Collapsible Stat Tree</title>
<style>
body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #f5f5f5;
}
.pokemon-card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 0 10px #ccc;
    padding: 20px;
    margin-bottom: 20px;
}
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
}
.header h2 {
    margin: 0;
}
.main-stats {
    margin-left: 22px;
    margin-bottom: 20px;
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center; /* center above the column */
}
.stat-circle {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
    font-size: 12px;
    text-align: center;
}
.circle {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 1px solid #999;
    display: inline-block;
    background: white;
}
.circle.active {
    background: gray;
}
.groups-container {
    display: flex;
    margin-top: 20px;
    gap: 20px;
}
.groups-column {
    display: flex;
    flex-direction: column;
    gap: 15px;
}
.group {
    display: flex;
    flex-direction: column;
}
.substats {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-left: 30px;
}
.collapsible-content {
    display: none;
}
.pokemon-card.expanded .collapsible-content {
    display: flex;
    gap: 20px;
}
.content-row {
    display: flex;
    gap: 20px;
    width: 100%;
}
.left-column {
    display: flex;
    flex-direction: column;
    align-items: center; /* center main stats above column */
}
.future-data {
    flex-grow: 1;
    height: 100%;
    background: #eee;
    border: 1px dashed #999;
}
</style>
</head>
<body>

<h1>All Pokémon in Game</h1>
<div id="pokemon-container"></div>

<script>
const apiUrl = "http://127.0.0.1:9000/PullAllPokemon/ixcgr496te"; // replace with your endpoint

function renderCircles(value, potential) {
    let html = "";
    for (let i = 0; i < potential; i++) {
        html += `<span class="circle ${i < value ? "active" : ""}"></span>`;
    }
    return html;
}

function createPokemonCard(pokemon) {
    const hp = (pokemon.BaseHealth || 0) + (pokemon.Vitality || 0);

    const mainStats = ["Strength", "Dexterity", "Vitality", "Special", "Insight"];
    const groups = {
        "Fight": ["Brawl", "Channel", "Clash", "Evasion"],
        "Survival": ["Alert", "Athletic", "NatureStat", "Stealth"],
        "Contest": ["Allure", "Etiquette", "Intimidate", "Perform"]
    };

    // Main stats HTML
    let mainStatsHtml = mainStats.map(stat => {
        const value = pokemon[stat] || 0;
        const potential = pokemon[stat + "Potential"] || value;
        return `<div class="stat-circle">
            <div style="font-size: 16px; font-weight: bold;">${stat}</div>
            <div>${renderCircles(value, potential)}</div>
        </div>`;
    }).join("");

    // Groups HTML (vertical column)
    let groupsHtml = Object.entries(groups).map(([groupName, substats]) => {
        const groupValue = pokemon[groupName] || 0;
        let substatsHtml = substats.map(sub => {
            const value = pokemon[sub] || 0;
            return `<div class="stat-circle">
                <div>${sub}</div>
                <div>${renderCircles(value, 5)}</div>
            </div>`;
        }).join("");

        return `
        <div class="group">
            <div class="stat-circle">
                <div style="font-size: 16px; font-weight: bold;">${groupName}</div>
                <div>${renderCircles(groupValue, 5)}</div>
            </div>
            <div class="substats">${substatsHtml}</div>
        </div>`;
    }).join("");

    return `
    <div class="pokemon-card">
        <div class="header" onclick="this.parentNode.classList.toggle('expanded')">
            <h2>${pokemon.Name} (Lvl ${pokemon.Level})</h2>
            <div>HP: ${hp}</div>
        </div>
        <div>Ability: ${pokemon.Ability} | Type: ${pokemon.PrimaryType}${pokemon.SecondaryType && pokemon.SecondaryType !== "None" ? "/" + pokemon.SecondaryType : ""}</div>
        <div class="collapsible-content">
            <div class="content-row">
                <div class="left-column">
                    <div class="main-stats">${mainStatsHtml}</div>
                    <div class="groups-column">${groupsHtml}</div>
                </div>
                <div class="future-data">Future data</div>
            </div>
        </div>
    </div>`;
}

async function fetchPokemon() {
    try {
        const response = await fetch(apiUrl);
        const result = await response.json();

        const container = document.getElementById("pokemon-container");
        container.innerHTML = "";

        if (!result.data || result.data.length === 0) {
            container.innerHTML = "<p>No Pokémon found.</p>";
            return;
        }

        result.data.forEach(pokemon => {
            container.innerHTML += createPokemonCard(pokemon);
        });
    } catch (err) {
        console.error("Error fetching Pokémon:", err);
    }
}

fetchPokemon();
</script>

</body>
</html>
