<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Item</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="p-5">
    <div class="container">
        <h1>Add New Pok√©mon Item</h1>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
        {% endwith %}
        
        <form id="addItemForm">
            <div class="mb-3">
                <label>Name</label>
                <input type="text" name="Name" class="form-control" required>
            </div>

            <div class="mb-3">
                <label>Description</label>
                <input type="text" name="Description" class="form-control">
            </div>

            <div class="mb-3">
                <label>Effect</label>
                <input type="text" name="Effect" class="form-control">
            </div>

            <div class="mb-3">
                <label>Item Category</label>
                <select name="ItemCategory" class="form-select" required>
                    {% for key, value in item_categories %}
                        <option value="{{ key }}" {% if loop.first %}selected{% endif %}>{{ value }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label>Minimum Shop Tier</label>
                <select name="MinShopTier" class="form-select" required>
                    {% for key, value in shop_tiers %}
                        <option value="{{ key }}" {% if loop.first %}selected{% endif %}>{{ value }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label>Buy Price</label>
                <input type="number" name="BuyPrice" class="form-control">
            </div>

            <div class="mb-3">
                <label>Sell Price</label>
                <input type="number" name="SellPrice" class="form-control">
            </div>

            <button type="submit" class="btn btn-primary">Add Item</button>
        </form>
    </div>
</body>

<script>
    const BASE_URL = "{{ baseUrl }}"
document.getElementById("addItemForm").addEventListener("submit", function(e) {
    e.preventDefault(); // Prevent normal form submission

    const form = e.target;

    // Build the JSON payload
    const data = {
        Name: form.Name.value,
        Description: form.Description.value,
        Effect: form.Effect.value,
        ItemCategory: form.ItemCategory.value,
        MinShopTier: form.MinShopTier.value,
        BuyPrice: parseInt(form.BuyPrice.value) || 0,
        SellPrice: parseInt(form.SellPrice.value) || 0
    };

    // Make the POST request
    fetch(`${BASE_URL}/item`, {  // replace with your actual backend URL
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        if (!response.ok) throw new Error("Failed to add item");
        return response.json();
    })
    .then(result => {
        alert("Item added successfully!");
        form.reset(); // Clear the form
    })
    .catch(err => {
        alert("Error: " + err.message);
        console.error(err);
    });
});
</script>

</html>
